{% extends "base.html" %}

{% block title %}Adicional Noturno{% endblock %}

{% block content %}
    {% load static %}
    
    <div class="container mt-5">
        <h1 class="text-center mb-4">Cálculo do Adicional Noturno</h1>
        
        <form id="adicional-noturno-form" action="{% url 'calcular_adicional_noturno' %}" method="POST" style="padding: 20px;">

            {% csrf_token %}
            
            <!-- Botões de opção para selecionar "Tradicional" ou "Escala" -->
            <div class="text-center mb-4">
                <label>
                    <input type="radio" name="tipo_calculo" value="tradicional" checked onclick="toggleCargaHoraria()"> Tradicional
                </label>
                <label class="ml-3">
                    <input type="radio" name="tipo_calculo" value="escala" onclick="toggleCargaHoraria()"> Escala
                </label>
            </div>

            <div class="row">
                <div class="form-group col-md-6 mb-3">
                    <label for="dias_semana">Dias da Semana</label>
                    <input type="number" step="0.01" name="dias_semana" placeholder="Dias da Semana" class="form-control" id="dias_semana">
                </div>

                <div class="form-group col-md-6 mb-3">
                    <label for="hora_semana">Total de Horas Semanais</label>
                    <input type="number" step="0.01" name="hora_semana" placeholder="Total de Horas Semanais" class="form-control" id="hora_semana">
                </div>

                <div class="form-group col-md-6 mb-3">
                    <label for="inicio_jornada">Início da Jornada de Trabalho</label>
                    <input type="time" name="inicio_jornada" class="form-control" id="inicio_jornada">
                </div>

                <div class="form-group col-md-6 mb-3">
                    <label for="fim_jornada">Término da Jornada de Trabalho</label>
                    <input type="time" name="fim_jornada" class="form-control" id="fim_jornada">
                </div>

                <!-- Novos campos de refeição -->
                <div class="form-group col-md-6 mb-3">
                    <label for="inicio_refeicao">Início do Intervalo de Refeição</label>
                    <input type="time" name="inicio_refeicao" class="form-control" id="inicio_refeicao">
                </div>

                <div class="form-group col-md-6 mb-3">
                    <label for="fim_refeicao">Término do Intervalo de Refeição</label>
                    <input type="time" name="fim_refeicao" class="form-control" id="fim_refeicao">
                </div>

                <div class="form-group col-md-6 mb-3">
                    <label for="minutos_compensacao">Minutos de Compensação</label>
                    <input type="number" step="0.01" name="minutos_compensacao" placeholder="Exemplo: 60 = 1 Hora" class="form-control" id="minutos_compensacao" style="font-style: italic;">
                </div>

                <!-- Novo campo a ser exibido na opção "Escala" -->
                <div class="form-group col-md-6 mb-3" id="carga-horaria-field" style="display: none;">
                    <label for="carga_horaria" class="text-center d-block">Carga Horária Diária</label> 
                    <input type="number" step="0.01" name="carga_horaria" placeholder="Exemplo: 8 = 8 Horas" class="form-control" id="carga_horaria">
                </div>
            </div>            

            <div class="text-center">
                <button type="submit" id="btn-avancar" class="btn btn-primary">Avançar</button>
                <button type="button" id="btn-clear" class="btn btn-danger">Limpar</button>
            </div>
        </form>

        <!-- Modal de Seleção de Tipo de Cálculo -->
        <div class="modal fade" id="tipoCalculoModal" tabindex="-1" aria-labelledby="tipoCalculoModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="tipoCalculoModalLabel">Escolha o Tipo de Cálculo</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="opcao_noturno" id="clt" value="clt">
                            <label class="form-check-label" for="clt">CLT</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="opcao_noturno" id="sumula" value="sumula">
                            <label class="form-check-label" for="sumula">Súmula 60</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="btn-calcular">Calcular</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para exibir os resultados -->
        <div class="modal fade" id="resultadoModal" tabindex="-1" aria-labelledby="resultadoModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="resultadoModalLabel">Resultado do Cálculo</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="modal-resultados"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="{% static 'js/avancar.js' %}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const inicioJornadaInput = document.getElementById("inicio_jornada");
            const fimJornadaInput = document.getElementById("fim_jornada");

            // Função para habilitar/desabilitar os campos
            function toggleJornadaFields() {
                if (inicioJornadaInput.value) {
                    fimJornadaInput.disabled = true;
                } else {
                    fimJornadaInput.disabled = false;
                }

                if (fimJornadaInput.value) {
                    inicioJornadaInput.disabled = true;
                } else {
                    inicioJornadaInput.disabled = false;
                }
            }

            // Adicionar event listeners para quando os campos forem preenchidos
            inicioJornadaInput.addEventListener("input", toggleJornadaFields);
            fimJornadaInput.addEventListener("input", toggleJornadaFields);

            // Executar a função ao carregar a página para garantir o estado correto
            toggleJornadaFields();
        });

        function toggleCargaHoraria() {
            const cargaHorariaField = document.getElementById('carga-horaria-field');
            const isEscala = document.querySelector('input[name="tipo_calculo"]:checked').value === 'escala';

            // Mostrar ou esconder o campo de carga horária baseado na opção selecionada
            cargaHorariaField.style.display = isEscala ? 'block' : 'none';
        }

        document.getElementById('btn-clear').addEventListener('click', function() {
            document.getElementById('adicional-noturno-form').reset();
            // Resetar visibilidade do campo de carga horária
            toggleCargaHoraria();
        });

        // Chama a função para definir a visibilidade inicial do campo de carga horária
        toggleCargaHoraria();

        
    </script>
{% endblock %}